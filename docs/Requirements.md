<h1 align = "center">NexTranslate 项目需求规格说明书</h1>

## 一、项目概述与目标

### 1.1 项目背景
在当今全球化的学术和技术环境中，英文是获取前沿知识和技术信息的主要语言。然而，对于广大的中文使用者，语言仍然是快速、准确获取信息的一大障碍。传统的翻译软件或在线翻译服务在处理格式复杂、内容专业的PDF文档（如学术论文、技术手册）时，往往存在以下痛点：
- **格式破坏**：翻译结果的排版混乱，图表、公式等关键元素丢失或错位。
- **术语不准**：缺乏对专业领域术语的优化，导致理解困难甚至产生误解。
- **操作繁琐**：需要用户手动复制粘贴文本，流程效率低下，无法处理图片型PDF。

### 1.2 核心问题
本项目的核心目标是解决科研人员、高校学生和技术工作者在阅读和翻译英文PDF文献时所面临的**效率**、**准确性**和**保真性**问题。即，如何提供一个能够智能识别PDF文档结构，准确翻译内容，并最大程度保留原始版式的自动化解决方案。

### 1.3 项目目标
`NexTranslate` 项目旨在开发一款桌面端的智能PDF翻译工具，通过集成先进的布局分析和机器翻译技术，实现以下核心目标：
- **高效性 (Efficiency)**: 实现对PDF文档的一键式、快速解析与翻译，支持批量处理。
- **准确性 (Accuracy)**: 保证专业文本内容的翻译质量，并提供中英双语对照功能以便精确校对。
- **保真性 (Fidelity)**: 最大程度地保留原文的排版布局，确保文本、图表、公式等元素的位置和结构清晰可读。
- **易用性 (Usability)**: 提供简洁直观的图形用户界面 (GUI) 和功能强大的命令行界面 (CLI)，满足不同用户的操作习惯。

---

## 二、用户画像与场景分析

### 2.1 目标用户画像

| 画像 | 身份特征 | 核心痛点 | 期望与诉求 |
| :--- | :--- | :--- | :--- |
| **研究生 小张** | 计算机硕士在读，需大量阅读前沿论文以完成文献综述和寻找创新点。 | - 筛选和阅读文献效率低。<br>- 无法快速判断论文核心价值。<br>- 传统翻译工具破坏PDF排版。 | **"我希望能快速翻译论文的摘要、引言和结论，帮我判断它是否值得精读。"** |
| **科研人员 李博士** | 材料学领域资深研究员，追求研究的深度和精度，论文中常含复杂图表和公式。 | - 通用翻译对专业术语翻译不准。<br>- PDF中的表格和公式无法被正确处理。<br>- 需要频繁进行原文译文比对，过程繁琐。 | **"我需要一份高质量、保留原版式的双语对照文档，让我能精确理解每个细节。"** |
| **技术工程师 王工** | 负责将英文设备手册、技术标准等进行本地化。 | - 手动翻译和排版工作量巨大、重复性高。<br>- 需要处理的文档数量多，希望有自动化流程。<br>- 图文混排的文档处理困难。 | **"我希望能批量处理PDF手册，自动生成翻译初稿，让我能专注于内容校对。"** |

### 2.2 核心用户场景

#### 场景一：论文快速筛选
- **情境**: 研究生小张正在进行文献调研，他有数十篇下载好的PDF论文，需要在一下午的时间里快速筛选出3-5篇与自己研究方向最相关的进行精读。
- **用户故事**: "作为一名研究生，我希望可以只翻译论文的特定几页（例如摘要、引言、结论），系统能快速生成一份纯中文的译稿，让我可以迅速评估论文的核心贡献，从而高效地完成文献筛选工作。"
- **交互流程**:
  1. 小张打开 `NexTranslate` 客户端。
  2. 将一篇PDF论文拖入界面。
  3. 在"页面范围"中输入 `1, 2, 10-12`（假设摘要在第1页，引言在第2页，结论在10-12页）。
  4. 选择生成"单语（纯中文）"文档。
  5. 点击"开始翻译"。几分钟后，他得到了一份只包含关键部分译文的PDF，快速阅读后判断出该论文与自己研究相关度不高，便继续处理下一篇，极大地提升了效率。

#### 场景二：论文深度精读
- **情境**: 李博士正在攻克一个研究难题，一篇高引用的英文综述论文对他至关重要。他需要逐字逐句地精确理解文章内容，特别是其中描述关键实验的表格和复杂的数学公式。
- **用户故事**: "作为一名科研人员，我需要一个能生成高质量双语对照文档的工具。它必须能正确处理文档中的表格和公式区域，并保持原有的布局，这样我才能在理解译文的同时，随时参照原文进行严谨的学术思考和引用。"
- **交互流程**:
  1. 李博士在 `NexTranslate` 中选择这篇关键论文。
  2. 在配置中，他选择了"生成双语（英中对照）"文档。
  3. 他确保所有内容元素（包括表格）都被设置为翻译。
  4. 点击"开始翻译"。系统处理完成后，他获得了一份排版精良的双语PDF。在阅读时，每一段英文原文下方都紧跟着对应的中文译文，表格和公式也原位保留，使得他对论文的理解既快又准。

#### 场景三：技术文档批量翻译
- **情境**: 工程师王工接到任务，需要将一个包含多个PDF章节的设备操作手册翻译成中文版。
- **用户故事**: "作为一名技术工程师，我希望能通过命令行工具，一次性处理整个文件夹的PDF文档，让程序自动完成初步的翻译和排版。这样不仅能将我从重复劳动中解放出来，也能保证所有章节的术语和风格初步统一，让我后续的校对工作事半功倍。"
- **交互流程**:
  1. 王工将所有手册的PDF章节文件放入 `D:\manuals\input` 文件夹。
  2. 他打开终端，执行命令：`nex-translate --input D:\manuals\input --output D:\manuals\output_zh`。
  3. 程序开始批量处理所有文件，并在控制台实时显示进度。
  4. 任务完成后，他在输出文件夹得到了所有章节对应的中文版PDF初稿。文档保留了原有的图片和表格结构，他只需在此基础上进行专业的审校即可。

---

## 三、系统功能需求

#### 3.1 FR-INPUT: 文件输入与处理
* FR-INPUT-01: 系统必须能接收用户上传的标准 PDF 文件（符合 PDF 1.7 标准）。
* FR-INPUT-02: 系统必须支持命令行界面(CLI)中选择多个 PDF 文件进行批量处理，图形界面(GUI)中支持单个文件处理。
* FR-INPUT-03: 系统在GUI模式下提供文件拖拽上传的功能，以提升用户体验。
* FR-INPUT-04: 系统应该允许用户指定处理 PDF 文件中的特定页面范围。
* FR-INPUT-05: 系统对于图片型PDF文件，通过布局分析模型识别不同内容区域，而不使用OCR技术。(注：OCR功能可作为未来扩展)
* FR-INPUT-06: 系统必须对输入文件进行基本验证（如：是否可读、非完全损坏）。

#### 3.2 FR-PARSE: 内容解析与识别
* FR-PARSE-01: 系统必须能够从 PDF 中准确提取文本内容。
* FR-PARSE-02: 系统必须能够识别并区分文档中的不同内容元素，至少包括：段落文本、图像/图形区域、表格区域、数学公式区域。
* FR-PARSE-03: 系统应该尝试理解文本的逻辑顺序，尤其是在多栏布局的页面中。
* FR-PARSE-04: 系统应该能识别页眉、页脚和页码，并允许用户选择是否在翻译中包含或排除它们。
* FR-PARSE-05: 系统应该能够识别表格的结构（行、列、单元格），并提取单元格内的文本。
* FR-PARSE-06: 系统应该能够识别数学公式区域。（注：识别其语义或转换为如 LaTeX 格式是高级目标）
* FR-PARSE-07: 系统应该能识别参考文献区域，并允许用户选择特定处理方式（如：不翻译）。

#### 3.3 FR-TRANSLATE: 翻译处理
* FR-TRANSLATE-01: 系统必须提供文本翻译功能，将从 PDF 提取的英文文本翻译为中文。
* FR-TRANSLATE-02: 系统可以支持集成多种外部翻译服务（如 Google, DeepL 等），并允许用户配置和选择使用哪种服务。
* FR-TRANSLATE-03: 系统必须允许用户配置翻译服务的认证信息（如 API Key）。
* FR-TRANSLATE-04: 系统应该提供选项，允许用户选择是否翻译特定类型的已识别元素（如：表格内的文本、图标题文本）。默认不翻译公式和图像本身。
* FR-TRANSLATE-05: 系统应该具备一定的错误处理能力，例如在翻译服务调用失败时进行重试或给出明确提示。

#### 3.4 FR-GENERATE: 输出文档生成
* FR-GENERATE-01: 系统必须能够生成包含翻译后文本以及原始非文本元素（图像、公式区域、表格区域等）的输出文档。
* FR-GENERATE-02: 系统必须支持生成 PDF 格式的输出文档。
* FR-GENERATE-03: 系统必须提供生成双语对照文档的选项（例如，原文和译文段落交错）。
* FR-GENERATE-04: 系统必须提供生成纯译文文档的选项。
* FR-GENERATE-05: 系统应该在生成的文档中，尽可能保持内容元素（文本、图、表、公式）的相对顺序和基本布局结构，以保证可读性。（注：精确像素级还原布局是极高目标，此处强调可读性和结构）
* FR-GENERATE-06: 系统应该在生成的 PDF 中处理好多语言字符的正确显示（如嵌入所需字体子集）。

#### 3.5 FR-UI: 用户界面与交互
* FR-UI-01: 系统必须提供一个图形用户界面 (GUI) 作为主要交互方式。
* FR-UI-02: GUI 必须允许用户执行文件选择、配置翻译参数、启动翻译、查看进度和获取结果的操作。
* FR-UI-03: GUI 必须清晰地显示翻译过程的状态和反馈信息（如进度百分比、当前步骤、错误提示）。
* FR-UI-04: GUI 提供翻译结果的预览功能。
* FR-UI-05: 系统提供一个命令行界面 (CLI)，支持通过参数执行核心翻译功能。

---

## 四、系统非功能性需求

#### 4.1 性能需求
- **响应时间**: 界面操作响应 < 100ms；文件加载时间 < 3s（对于10MB以内的标准PDF）；翻译处理速度 > 10页/分钟（依赖于网络和翻译API）。
- **资源占用**: 正常运行时，CPU平均使用率 < 50%；内存占用 < 1GB。
- **磁盘占用**: 应用安装后占用磁盘空间 < 500MB。

#### 4.2 可靠性需求
- **稳定性**: 在典型用户场景下，系统应能长时间稳定运行，崩溃率 < 0.1%。
- **健壮性**: 对常见异常（如文件损坏、网络中断、API Key错误）有妥善的捕获和提示机制。

#### 4.3 兼容性需求
- **操作系统**: Windows 10/11。
- **软件依赖**: Python 3.10+，所有依赖库通过打包工具管理。
- **文件格式**: 兼容 PDF 1.7 标准。
- **文本编码**: 全面支持 UTF-8 编码。

#### 4.4 可维护性需求
- **代码规范**: 遵循 PEP 8 编码规范，具有清晰的模块化设计。
- **文档注释**: 核心函数和模块有明确的注释文档。
- **测试覆盖**: 核心功能的单元测试覆盖率 > 80%。

---

## 五、用户使用流程

### 1. GUI模式
1. **启动程序**: 打开 `NexTranslate` 应用程序。
2. **选择文件**: 通过点击"选择文件"按钮或直接将PDF文件拖拽到程序窗口。
3. **配置参数 (可选)**:
   - **页面范围**: 选择"全部"、"首页"或自定义范围（如 `1-5, 8, 10-12`）。
   - **输出模式**: 选择生成"单语（纯中文）"或"双语（英中对照）"文档。
   - **高级选项**: 配置翻译API Key、代理等。
4. **开始翻译**: 点击"开始翻译"按钮。
5. **查看进度**: 界面上会显示当前处理状态、进度条和耗时信息。
6. **获取结果**: 任务完成后，程序会自动在源文件目录生成译文PDF，并提供直接打开文件的链接。

### 2. 命令行模式
1. **调用CLI**: 在终端中通过 `nex-translate` 命令调用程序。
2. **指定参数**:
   - 输入文件/目录：`--input <file_or_dir_path>`
   - 输出目录：`--output <dir_path>`
   - 页面范围：`--pages <page_ranges>`
   - 翻译服务：`--service <service_name>`
3. **执行命令**: 在控制台查看实时进度条和日志信息。
4. **获取结果**: 任务完成后，在指定的输出目录中找到生成的单语和双语译文PDF文档。

---

## 六、技术选型

#### 6.1 核心技术栈
| 项目 | 技术选型 | 说明 |
|------|----------|------|
| 编程语言 | Python 3.10+ | 主要开发语言 |
| GUI框架 | Gradio | 构建基于Web的现代化、简洁的图形用户界面 |
| PDF处理 | PyMuPDF (fitz) | 用于PDF的文本/图像提取、页面解析和文档重建 |
| 布局分析 | ONNX (babeldoc) | 运行预训练的布局分析模型，识别PDF中的文本、表格、图片、公式等区域 |
| 翻译服务 | Google Translate API | 核心英译中翻译引擎 |
| 数据存储 | SQLite (via Peewee) | 用于持久化存储用户配置和翻译缓存 |
| 打包工具 | Hatchling | 现代化的Python项目打包和构建工具 |

#### 6.2 主要依赖库
- **文档处理**: `PyMuPDF`, `pdfminer.six`
- **布局分析**: `onnxruntime`, `babeldoc`
- **网络请求**: `requests`, `tenacity` (实现API调用重试)
- **数据处理**: `numpy`
- **用户界面**: `gradio`, `gradio_pdf`
- **存储系统**: `peewee` (ORM), `sqlite`
- **辅助工具**: `tqdm` (为CLI提供进度条)